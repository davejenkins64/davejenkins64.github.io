<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Installing Vagrant | Dave Jenkins’ Portfolio</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Installing Vagrant" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This site is a cross between a blog and a portfolio of projects I’m interested in." />
<meta property="og:description" content="This site is a cross between a blog and a portfolio of projects I’m interested in." />
<link rel="canonical" href="/vagrant" />
<meta property="og:url" content="/vagrant" />
<meta property="og:site_name" content="Dave Jenkins’ Portfolio" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Installing Vagrant" />
<script type="application/ld+json">
{"headline":"Installing Vagrant","url":"/vagrant","description":"This site is a cross between a blog and a portfolio of projects I’m interested in.","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Dave Jenkins' Portfolio" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Dave Jenkins&#39; Portfolio</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/compute_node">Virtual Lab</a><a class="page-link" href="/about">About Me</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Installing Vagrant</h1>
  </header>

  <div class="post-content">
    <h2 id="vagrant-installconfigure">Vagrant Install/Configure</h2>

<p>Vagrant can fire up VMs for us.  It needs a provider to do the actual
work, and the “default” one appears to be virtualbox.</p>

<p>So, for now, I’m installing installing vagrant and virtualbox</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>apt <span class="nb">install </span>virtualbox vagrant virtualbox-dkms linux-headers-generic</code></pre></figure>

<p>Note, when installing virtualbox on an EFI host, it made a password
for secure boot, I chose ‘user_user’ but not sure how this is really used.</p>

<p>But perhaps also install vagrant-libvirt as another provider.
Can be done from vagrant: <code class="language-plaintext highlighter-rouge">vagrant plugin install vagrant-libvirt</code></p>

<p>This does not seem to work.  Skipping for now.
But <code class="language-plaintext highlighter-rouge">vagrant plugin list</code> does show libvirt:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">vagrant-libvirt <span class="o">(</span>0.0.45, system<span class="o">)</span></code></pre></figure>

<p>Try adding vagrant-lxc too to get another provider?  No, the plugin list
is still only vagrant-libvirt.
And it also seems that only <code class="language-plaintext highlighter-rouge">lxc</code> images can be started.</p>

<h2 id="vagrant-tutorial">Vagrant Tutorial</h2>

<h3 id="initializing">Initializing</h3>

<p>First, run vagrant init:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">vagrant init</code></pre></figure>

<p>Says:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">A <span class="sb">`</span>Vagrantfile<span class="sb">`</span> has been placed <span class="k">in </span>this directory. You are now
ready to <span class="sb">`</span>vagrant up<span class="sb">`</span> your first virtual environment! Please <span class="nb">read
</span>the comments <span class="k">in </span>the Vagrantfile as well as documentation on
<span class="sb">`</span>vagrantup.com<span class="sb">`</span> <span class="k">for </span>more information on using Vagrant.</code></pre></figure>

<h3 id="bringing-up-a-vm">Bringing up a VM</h3>

<p>Edit the Vagrantfile.  I think it wants us to choose an image to boot,
and to edit “base” to be the name of the image.  Running with this unchanged
yields:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>vagrant up</code></pre></figure>

<p>Yields:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">The <span class="sb">`</span>lxc<span class="sb">`</span> package does not seem to be installed or <span class="sb">`</span>lxc-create<span class="sb">`</span> is not accessible on the PATH.</code></pre></figure>

<p>So let’s also install lxc-utils.</p>

<p>Now when we try <code class="language-plaintext highlighter-rouge">sudo vagrant up</code> we get:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>vagrant up
Bringing machine <span class="s1">'default'</span> up with <span class="s1">'lxc'</span> provider...
<span class="o">==&gt;</span> default: Box <span class="s1">'base'</span> could not be found. Attempting to find and install...
    default: Box Provider: lxc
    default: Box Version: <span class="o">&gt;=</span> 0
<span class="o">==&gt;</span> default: Box file was not detected as metadata. Adding it directly...
<span class="o">==&gt;</span> default: Adding box <span class="s1">'base'</span> <span class="o">(</span>v0<span class="o">)</span> <span class="k">for </span>provider: lxc
    default: Downloading: base
An error occurred <span class="k">while </span>downloading the remote file. The error
message, <span class="k">if </span>any, is reproduced below. Please fix this error and try
again.

Couldn<span class="s1">'t open file /home/user/base</span></code></pre></figure>

<p>So, my provider appears to be <code class="language-plaintext highlighter-rouge">lxc</code> and https://vagrantcloud.com/search 
says a recently updated ubuntu 20.04 is <code class="language-plaintext highlighter-rouge">capensis/ubuntu20.04</code>, so I change
base to that and try again.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>vagrant up</code></pre></figure>

<p>Yields:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Bringing machine <span class="s1">'default'</span> up with <span class="s1">'lxc'</span> provider...
<span class="o">==&gt;</span> default: Box <span class="s1">'capensis/ubuntu20.04'</span> could not be found. Attempting to find and install...
    default: Box Provider: lxc
    default: Box Version: <span class="o">&gt;=</span> 0
<span class="o">==&gt;</span> default: Loading metadata <span class="k">for </span>box <span class="s1">'capensis/ubuntu20.04'</span>
    default: URL: https://vagrantcloud.com/capensis/ubuntu20.04
<span class="o">==&gt;</span> default: Adding box <span class="s1">'capensis/ubuntu20.04'</span> <span class="o">(</span>v0.1<span class="o">)</span> <span class="k">for </span>provider: lxc
    default: Downloading: https://vagrantcloud.com/capensis/boxes/ubuntu20.04/versions/0.1/providers/lxc.box
    default: Download redirected to host: vagrantcloud-files-production.s3.amazonaws.com
<span class="o">==&gt;</span> default: Successfully added box <span class="s1">'capensis/ubuntu20.04'</span> <span class="o">(</span>v0.1<span class="o">)</span> <span class="k">for</span> <span class="s1">'lxc'</span><span class="o">!</span>
<span class="o">==&gt;</span> default: Importing base box <span class="s1">'capensis/ubuntu20.04'</span>...
<span class="o">==&gt;</span> default: Checking <span class="k">if </span>box <span class="s1">'capensis/ubuntu20.04'</span> version <span class="s1">'0.1'</span> is up to date...
<span class="o">==&gt;</span> default: Setting up mount entries <span class="k">for </span>shared folders...
    default: /vagrant <span class="o">=&gt;</span> /home/user
<span class="o">==&gt;</span> default: Starting container...
<span class="o">==&gt;</span> default: Waiting <span class="k">for </span>machine to boot. This may take a few minutes...
    default: SSH address: 10.0.3.165:22
    default: SSH username: vagrant
    default: SSH auth method: private key
    default: 
    default: Vagrant insecure key detected. Vagrant will automatically replace
    default: this with a newly generated keypair <span class="k">for </span>better security.
    default: 
    default: Inserting generated public key within guest...
    default: Removing insecure key from the guest <span class="k">if </span>it<span class="s1">'s present...
    default: Key inserted! Disconnecting and reconnecting using new SSH key...
==&gt; default: Machine booted and ready!</span></code></pre></figure>

<p>Hmm, but since I ran it with sudo, is it root’s private key?</p>

<p>Did it really work?</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>vagrant status</code></pre></figure>

<p>Yields:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Current machine states:

default                   running <span class="o">(</span>lxc<span class="o">)</span>

The VM is running. To stop this VM, you can run <span class="sb">`</span>vagrant halt<span class="sb">`</span> to
shut it down forcefully, or you can run <span class="sb">`</span>vagrant <span class="nb">suspend</span><span class="sb">`</span> to simply
<span class="nb">suspend </span>the virtual machine. In either <span class="k">case</span>, to restart it again,
simply run <span class="sb">`</span>vagrant up<span class="sb">`</span>.</code></pre></figure>

<p>So, let’s get a keypair generated for root and user and see which one
vagrant is using for authentication?</p>

<h3 id="cheat-sheet">Cheat Sheet</h3>

<p><code class="language-plaintext highlighter-rouge">vagrant halt</code> seemed to work, but leaves the image halted. The command
<code class="language-plaintext highlighter-rouge">vagrant destroy</code> then cleans up the VM, but the image stays around and
is cached to be used as a template to make future VMs.</p>

<p>Note: once you can ssh into a container, you’ll be the vagrant user in /home/vagrant and
all files in /vargrant will be sync’ed with the directory that holds the Vagrantfile.
So, one box per directory, multiple directories to make a swarm.</p>

<p>TODO: how to we attach a nework between VMs. First thing to try would be
to look in Vagrantfile for comments on public/private networks.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Dave Jenkins&#39; Portfolio</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Dave Jenkins&#39; Portfolio</li><li><a class="u-email" href="mailto:davejenkins64@gmail.com">davejenkins64@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/davejenkins64"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">davejenkins64</span></a></li><li><a href="https://www.linkedin.com/in/davejenkins64"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">davejenkins64</span></a></li><li><a href="https://www.twitter.com/davejenkins64"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">davejenkins64</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This site is a cross between a blog and a portfolio of projects I&#39;m  interested in.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
